jQuery(function(e){function t(){function t(t){""!=t&&(e(t).css("float","none"),e(t).css("visibility","visible"),e(t).show())}function a(t){""!=t&&(e(t).hide(),e(t).css("visibility","hidden"))}function n(t){""!=t&&e(t).show().fadeOut(1500)}var o=this;o={displayChecked:function(e,t,i,a){var n=i?!e.checked:e.checked;a?n?t.attr("disabled","disabled"):t.removeAttr("disabled"):n?t.show():t.hide()},isEmpty:function(t){return t=e.trim(t),!t||0===t.length},isNumber:function(t){return t=e.trim(t),!o.isEmpty(t)&&!isNaN(t)},getMceContent:function(t){if("undefined"==typeof tinymce||null==typeof tinymce||void 0===tinymce.editors)return e("#"+t).val();var i=tinymce.editors[t];return null==i||i.isHidden()?e("#"+t).val():i.getContent()},ajaxPost:function(t,i,a){var n=jQuery("#wpProQuiz_nonce").data("nonce"),o={action:"wp_pro_quiz_admin_ajax",nonce:n,func:t,data:i};e.post(ajaxurl,o,a,"json")}};var r=function(){e(".wpProQuiz_tab_wrapper a").on("click",function(){var t=e(this),i=t.data("tab"),a=t.siblings(".button-primary").removeClass("button-primary").addClass("button-secondary");return t.removeClass("button-secondary").addClass("button-primary"),e(a.data("tab")).hide("fast"),e(i).show("fast"),e(document).trigger({type:"changeTab",tabId:i}),!1})},s={gobalSettings:function(){var i={categoryDelete:function(i){var r={categoryId:i};t(".categorySpinner"),o.ajaxPost("categoryDelete",r,function(t){t.err||(a(".categorySpinner"),n(".categoryDeleteUpdate"),e('select[name="category"] option[value="'+i+'"]').remove(),e('select[name="category"]').change())})},categoryEdit:function(i,r){var s={categoryId:i,categoryName:e.trim(r)};o.isEmpty(r)?alert(wpProQuizLocalize.category_no_name):(t(".categorySpinner"),o.ajaxPost("categoryEdit",s,function(t){t.err||(a(".categorySpinner"),n(".categoryEditUpdate"),e('select[name="category"] option[value="'+i+'"]').text(s.categoryName),e('select[name="category"]').val(""),e('select[name="category"]').change())}))},changeTimeFormat:function(t,i){"0"!=i.val()&&e('input[name="'+t+'"]').val(i.val())},templateDelete:function(i,r){var s={templateId:i,type:r};t(r?".templateQuestionSpinner":".templateQuizSpinner"),o.ajaxPost("templateDelete",s,function(t){t.err||(r?(a(".templateQuestionSpinner"),n(".templateQuestionDeleteUpdate"),e('select[name="templateQuestion"] option[value="'+i+'"]').remove(),e('select[name="templateQuestion"]').val(""),e('select[name="templateQuestion"]').change()):(a(".templateQuizSpinner"),n(".templateQuizDeleteUpdate"),e('select[name="templateQuiz"] option[value="'+i+'"]').remove(),e('select[name="templateQuiz"]').val(""),e('select[name="templateQuiz"]').change()))})},templateEdit:function(i,r,s){if(o.isEmpty(r))alert(wpProQuizLocalize.category_no_name);else{var c={templateId:i,name:e.trim(r),type:s};t(s?".templateQuestionSpinner":".templateQuizSpinner"),o.ajaxPost("templateEdit",c,function(t){t.err||(s?(a(".templateQuestionSpinner"),n(".templateQuestionEditUpdate"),e('select[name="templateQuestion"] option[value="'+i+'"]').text(c.name),e('select[name="templateQuestion"]').val(""),e('select[name="templateQuestion"]').change()):(a(".templateQuizSpinner"),n(".templateQuizEditUpdate"),e('select[name="templateQuiz"] option[value="'+i+'"]').text(c.name),e('select[name="templateQuiz"]').val(""),e('select[name="templateQuiz"]').change()))})}}},r=function(){e('select[name="category"]').on("change",function(){""!=e(this).val()?e('input[name="categoryEditText"]').val(e("option:selected",this).text()):e('input[name="categoryEditText"]').val("")}),e('input[name="categoryDelete"]').on("click",function(){var t=e('select[name="category"] option:selected').val();""!=t&&i.categoryDelete(t)}),e('input[name="categoryEdit"]').on("click",function(){var t=e('select[name="category"] option:selected').val();if(""!=t){var a=e('input[name="categoryEditText"]').val();i.categoryEdit(t,a)}}),e('select[name="templateQuiz"]').on("change",function(){""!=e(this).val()?e('input[name="templateQuizEditText"]').val(e("option:selected",this).text()):e('input[name="templateQuizEditText"]').val("")}),e('input[name="templateQuizEdit"]').on("click",function(){var t=e('select[name="templateQuiz"] option:selected').val();if(""!=t){var a=e('input[name="templateQuizEditText"]').val();i.templateEdit(t,a,0)}}),e('input[name="templateQuizDelete"]').on("click",function(){var t=e('select[name="templateQuiz"] option:selected').val();""!=t&&i.templateDelete(t,0)}),e('select[name="templateQuestion"]').on("change",function(){""!=e(this).val()?e('input[name="templateQuestionEditText"]').val(e("option:selected",this).text()):e('input[name="templateQuestionEditText"]').val("")}),e('input[name="templateQuestionEdit"]').on("click",function(){var t=e('select[name="templateQuestion"] option:selected').val();if(""!=t){var a=e('input[name="templateQuestionEditText"]').val();i.templateEdit(t,a,1)}}),e('input[name="templateQuestionDelete"]').on("click",function(){var t=e('select[name="templateQuestion"] option:selected').val();""!=t&&i.templateDelete(t,1)}),e("#statistic_time_format_select").on("change",function(){i.changeTimeFormat("statisticTimeFormat",e(this))}),e(document).bind("changeTab",function(t){switch(e("#problemInfo").hide("fast"),t.tabId){case"#problemContent":e("#problemInfo").show("fast")}})};r()},questionEdit:function(){var t=this,i=e.noop(),a={answerChildren:e(".answer_felder > div"),pointsModus:e('input[name="answerPointsActivated"]'),gPoints:e('input[name="points"]')};t={generateArrayIndex:function(){var t=e('input[name="answerType"]:checked').val();t="single"==t||"multiple"==t?"classic_answer":t,e(".answerList").each(function(){var i=e(this).parent().attr("class");e(this).children().each(function(a,n){e(this).find('[name^="answerData"]').each(function(){var e=this.name,n=e.search(/\](\[\w+\])+$/),o=t==i?a:"none";n>0&&(this.name="answerData["+o+e.substring(n,e.length))})})})},globalValidate:function(){if("undefined"!==typenow&&"sfwd-question"==typenow){if(o.isEmpty(o.getMceContent("content")))return alert(wpProQuizLocalize.no_question_msg),!1}else if(o.isEmpty(o.getMceContent("question")))return alert(wpProQuizLocalize.no_question_msg),!1;if(!a.pointsModus.is(":checked")){var e=a.gPoints.val();if(!o.isNumber(e)||e<1)return alert(wpProQuizLocalize.no_nummber_points),!1}return!1!==i()},answerRemove:function(){var t=e(this).parent();return t.parent().children().length>1?t.remove():alert(wpProQuizLocalize.no_delete_answer),!1},addCategory:function(){var t=e.trim(e('input[name="categoryAdd"]').val()),i=jQuery("#wpProQuiz_nonce").data("nonce");if(!o.isEmpty(t)){var a={categoryName:t,nonce:i};o.ajaxPost("categoryAdd",a,function(t){if(t.err)e("#categoryMsgBox").text(t.err).show("fast").delay(2e3).hide("fast");else{var i=e(document.createElement("option")).val(t.categoryId).text(t.categoryName).attr("selected","selected");e('select[name="category"]').append(i).change()}})}},addMediaClick:function(){var t,i=e(this).closest("li"),a=i.find('input[name="answerData[][html]"]:eq(0)'),n=i.find(".wpProQuiz_text:eq(0)");void 0===t?(t=wp.media.frames.media_upload_frame=wp.media({frame:"select",library:{type:["image","audio","video"]},multiple:!1}),t.on("select",function(){var e=t.state().get("selection").first().toJSON();"image"===e.type&&(n.val(n.val()+'<img src="'+e.url+'" alt="'+e.alt+'" />'),a.attr("checked",!0)),"audio"===e.type&&(n.val(n.val()+'[audio src="'+e.url+'"][/audio]'),a.attr("checked",!0)),"video"===e.type&&(n.val(n.val()+'[video src="'+e.url+'"][/video]'),a.attr("checked",!0))}),t.open()):t.open()}};var n={classic_answer:function(){var t=0,i=0,n=0;return e(".classic_answer .answerList").children().each(function(){var a=e(this);if(!o.isEmpty(a.find('textarea[name="answerData[][answer]"]').val())){t++,a.find('input[name="answerData[][correct]"]:checked').length&&i++;var r=a.find('input[name="answerData[][points]"]').val();o.isNumber(r)&&r>=0&&n++}}),t?i||e('input[name="disableCorrect"]').is(":checked")&&e('input[name="answerPointsDiffModusActivated"]').is(":checked")&&e('input[name="answerPointsActivated"]').is(":checked")&&("single"==e('input[name="answerType"]:checked').val()||"multiple"==e('input[name="answerType"]:checked').val())?n==t||!a.pointsModus.is(":checked")||(alert(wpProQuizLocalize.no_nummber_points_new),!1):(alert(wpProQuizLocalize.no_correct_msg),!1):(alert(wpProQuizLocalize.no_answer_msg),!1)},free_answer:function(){return!o.isEmpty(e('.free_answer textarea[name="answerData[][answer]"]').val())||(alert(wpProQuizLocalize.no_answer_msg),!1)},cloze_answer:function(){return!o.isEmpty(o.getMceContent("cloze"))||(alert(wpProQuizLocalize.no_answer_msg),!1)},sort_answer:function(){var t=0,i=0;return e(".sort_answer .answerList").children().each(function(){var a=e(this);if(!o.isEmpty(a.find('textarea[name="answerData[][answer]"]').val())){t++;var n=a.find('input[name="answerData[][points]"]').val();o.isNumber(n)&&n>=0&&i++}}),t?i==t||!a.pointsModus.is(":checked")||(alert(wpProQuizLocalize.no_nummber_points_new),!1):(alert(wpProQuizLocalize.no_answer_msg),!1)},matrix_sort_answer:function(){var t=0,i=0,n=!0,r=0;return e(".matrix_sort_answer .answerList").children().each(function(){var a=e(this),s=a.find('input[name="answerData[][points]"]').val();o.isEmpty(a.find('textarea[name="answerData[][answer]"]').val())?o.isEmpty(a.find('textarea[name="answerData[][sort_string]"]').val())||(r++,o.isNumber(s)&&s>=0&&i++):(t++,r++,o.isEmpty(a.find('textarea[name="answerData[][sort_string]"]').val())&&(n=!1),o.isNumber(s)&&s>=0&&i++)}),t?n?i==r||!a.pointsModus.is(":checked")||(alert(wpProQuizLocalize.no_nummber_points_new),!1):(alert(wpProQuizLocalize.no_sort_element_criterion),!1):(alert(wpProQuizLocalize.no_answer_msg),!1)},assessment_answer:function(){return!o.isEmpty(o.getMceContent("assessment"))||(alert(wpProQuizLocalize.no_answer_msg),!1)}},r=function(){e("#wpProQuiz_tip").on("change",function(){o.displayChecked(this,e("#wpProQuiz_tipBox"))}).change(),e("#wpProQuiz_correctSameText").on("change",function(){o.displayChecked(this,e("#wpProQuiz_incorrectMassageBox"),!0),o.displayChecked(this,e("#learndash_question_message_incorrect_answer"),!0)}),e('input[name="answerType"]').on("click",function(){a.answerChildren.hide();var t=this.value,o=e('input[name="answerPointsActivated"]').is(":checked"),r=!1;if(1==o&&(r=!0),"single"==t?("undefined"!==typenow&&"sfwd-question"==typenow?e("#learndash_question_single_choice_options").show():e("#singleChoiceOptions").show(),e('input[name="disableCorrect"]').change()):("undefined"!==typenow&&"sfwd-question"==typenow?e("#learndash_question_single_choice_options").hide():e("#singleChoiceOptions").hide(),e(".classic_answer .wpProQuiz_classCorrect").parent().parent().show()),"single"==t||"multiple"==t){var s="single"==t?"radio":"checkbox";t="classic_answer",e('input[name="points"]').attr("disabled",r),e("#wpProQuiz_answerPointsActivated").show(),e('input[name="answerPointsActivated"]').attr("disabled",!1),e('input[name="correctSameText"]').attr("disabled",!1),e(".wpProQuiz_classCorrect").each(function(){e("<input type="+s+" />").attr({name:this.name,value:this.value,checked:this.checked}).addClass("wpProQuiz_classCorrect wpProQuiz_checkbox").insertBefore(this)}).remove()}else"free_answer"==t?(e('input[name="points"]').attr("disabled",r),e("#wpProQuiz_answerPointsActivated").show(),e('input[name="answerPointsActivated"]').attr("disabled",!1),e('input[name="correctSameText"]').attr("disabled",!1)):"sort_answer"==t?(e('input[name="points"]').attr("disabled",r),e("#wpProQuiz_answerPointsActivated").show(),e('input[name="answerPointsActivated"]').attr("disabled",!1),e('input[name="correctSameText"]').attr("disabled",!1)):"matrix_sort_answer"==t?(e('input[name="points"]').attr("disabled",r),e("#wpProQuiz_answerPointsActivated").show(),e('input[name="answerPointsActivated"]').attr("disabled",!1),e('input[name="correctSameText"]').attr("disabled",!1)):"cloze_answer"==t?(e('input[name="points"]').attr("disabled",r),e("#wpProQuiz_answerPointsActivated").show(),e('input[name="answerPointsActivated"]').attr("disabled",!1),e('input[name="correctSameText"]').attr("disabled",!1)):"assessment_answer"==t?(e('input[name="points"]').attr("disabled",r),e("#wpProQuiz_answerPointsActivated").show(),e('input[name="answerPointsActivated"]').attr("checked",!0),e('input[name="answerPointsActivated"]').attr("disabled",!0),e('input[name="correctSameText"]').attr("checked",!0),e('input[name="correctSameText"]').attr("disabled",!0),e("#learndash_question_message_incorrect_answer").hide()):"essay"==t?(e('input[name="answerPointsActivated"]').attr("checked",!1),e('input[name="showPointsInBox"]').attr("checked",!1),e('input[name="points"]').attr("disabled",!1),e("#wpProQuiz_answerPointsActivated").show(),e('input[name="answerPointsActivated"]').attr("checked",!1),e('input[name="answerPointsActivated"]').attr("disabled",!0),e('input[name="correctSameText"]').attr("checked",!0),e("#learndash_question_message_correct_answer .postbox-header h2").html(wpProQuizLocalize.metabox_title_correct_message_essay),e("#learndash_question_message_correct_answer .inside .learndash-same-answer-text").hide(),e("#learndash_question_message_correct_answer .inside p.description").hide(),e("#wpProQuiz_incorrectMassageBox").hide(),e("#learndash_question_message_incorrect_answer").hide(),e('textarea[name="incorrectMsg"]').val("")):(e("#wpProQuiz_answerPointsActivated").show(),e("#wpProQuiz_correctMessageBox").show(),e("#learndash_question_message_correct_answer").show(),e("#learndash_question_message_correct_answer .postbox-header h2").html(wpProQuizLocalize.metabox_title_correct_message),e("#learndash_question_message_correct_answer .inside .learndash-same-answer-text").show(),e("#learndash_question_message_correct_answer .inside p.description").show(),e("#wpProQuiz_incorrectMassageBox").show(),e("#learndash_question_message_incorrect_answer").show());i=null!=n[t]?n[t]:e.noop(),e("."+t).show()}),setTimeout(()=>{e('input[name="answerType"]:checked').click()},500),e("#wpProQuiz_correctSameText").change(),e(".deleteAnswer").on("click",t.answerRemove),e(".addAnswer").on("click",function(){var i=e(this).attr("data-default-value");null==i&&(i=0);var a=e(this).siblings("ul"),n=a.find("li:eq(0)").clone();return n.find(".wpProQuiz_checkbox").removeAttr("checked"),n.find(".wpProQuiz_text").val(""),n.find(".wpProQuiz_points").val(i),n.find(".deleteAnswer").on("click",t.answerRemove),n.find(".addMedia").on("click",t.addMediaClick),n.appendTo(a),!1}),e(".sort_answer ul, .classic_answer ul, .matrix_sort_answer ul").sortable({handle:".wpProQuiz_move"}),e("#saveQuestion").on("click",function(){return!!t.globalValidate()&&(t.generateArrayIndex(),!0)}),e("#publish").on("click",function(){return!!t.globalValidate()&&(t.generateArrayIndex(),!0)}),e("#save-post").on("click",function(){return!!t.globalValidate()&&(t.generateArrayIndex(),!0)}),e(a.pointsModus).on("change",function(){o.displayChecked(this,e(".wpProQuiz_answerPoints")),o.displayChecked(this,a.gPoints,!1,!0),o.displayChecked(this,e('input[name="answerPointsDiffModusActivated"]'),!0,!0),this.checked?(e('input[name="answerPointsDiffModusActivated"]').change(),e('input[name="disableCorrect"]').change(),e('input[name="showPointsInBox"]').attr("disabled",!1)):(e(".classic_answer .wpProQuiz_classCorrect").parent().parent().show(),e('input[name="disableCorrect"]').attr("disabled","disabled"),e('input[name="showPointsInBox"]').attr("disabled",!0))}).change(),e('select[name="category"]').on("change",function(){var t=e(this),i=e("#categoryAddBox").hide();"-1"==t.val()&&i.show()}).change(),e("#categoryAddBtn").on("click",function(){t.addCategory()}),e(".addMedia").on("click",t.addMediaClick),e('input[name="answerPointsDiffModusActivated"]').on("change",function(){o.displayChecked(this,e('input[name="disableCorrect"]'),!0,!0),this.checked?e('input[name="disableCorrect"]').change():e(".classic_answer .wpProQuiz_classCorrect").parent().parent().show()}).change(),e('input[name="disableCorrect"]').on("change",function(){o.displayChecked(this,e(".classic_answer .wpProQuiz_classCorrect").parent().parent(),!0)}).change(),e("#clickPointDia").on("click",function(){return e(".pointDia").toggle("fast"),!1}),e('input[name="template"]').on("click",function(i){if("0"==e('select[name="templateSaveList"]').val()&&o.isEmpty(e('input[name="templateName"]').val()))return alert(wpProQuizLocalize.temploate_no_name),i.preventDefault(),!1;t.generateArrayIndex()}),e('select[name="templateSaveList"]').on("change",function(){var t=e('input[name="templateName"]');"0"==e(this).val()?t.show():t.hide()}).change()},s=function(){a.answerChildren.hide(),r()};s()},statistic:function(){var t=this,i=e("#quizId").val(),a="users",n={currentPage:e("#wpProQuiz_currentPage"),pageLeft:e("#wpProQuiz_pageLeft"),pageRight:e("#wpProQuiz_pageRight"),testSelect:e("#testSelect")};t={loadStatistic:function(e,t){var i={userId:e};o.ajaxPost("statisticLoad",i,function(e){})},loadUsersStatistic:function(){var a=e("#userSelect").val(),n={userId:a,quizId:i,testId:e("#testSelect").val()};t.toggleLoadBox(!1),o.ajaxPost("statisticLoad",n,function(i){e.each(i.question,function(){var i=e("#wpProQuiz_tr_"+this.questionId);t.setStatisticData(i,this)}),e.each(i.category,function(i,a){var n=e("#wpProQuiz_ctr_"+i);t.setStatisticData(n,a)}),e("#testSelect option:gt(0)").remove();var a=e("#testSelect");e.each(i.tests,function(){var t=e(document.createElement("option"));t.val(this.id),t.text(this.date),i.testId==this.id&&t.attr("selected",!0),a.append(t)}),t.parseFormData(i.formData),t.toggleLoadBox(!0)})},loadUsersStatistic_:function(a,n){var r={userId:a,quizId:i,testId:n};t.toggleLoadBox(!1),o.ajaxPost("statisticLoad",r,function(i){e.each(i.question,function(){var i=e("#wpProQuiz_tr_"+this.questionId);t.setStatisticData(i,this)}),e.each(i.category,function(i,a){var n=e("#wpProQuiz_ctr_"+i);t.setStatisticData(n,a)}),e("#testSelect option:gt(0)").remove();var o=e("#testSelect");e.each(i.tests,function(){var t=e(document.createElement("option"));t.val(this.id),t.text(this.date),i.testId==this.id&&t.attr("selected",!0),o.append(t)}),t.parseFormData(i.formData),e("#userSelect").val(a),e("#testSelect").val(n),t.toggleLoadBox(!0)})},parseFormData:function(t){var i=e("#wpProQuiz_form_box");null!=t?(e.each(t,function(t,i){e("#form_id_"+t).text(i)}),i.show()):i.hide()},setStatisticData:function(e,t){e.find(".wpProQuiz_cCorrect").text(t.correct),e.find(".wpProQuiz_cIncorrect").text(t.incorrect),e.find(".wpProQuiz_cTip").text(t.hint),e.find(".wpProQuiz_cPoints").text(t.points),e.find(".wpProQuiz_cResult").text(t.result),e.find(".wpProQuiz_cTime").text(t.questionTime),e.find(".wpProQuiz_cCreateTime").text(t.date)},toggleLoadBox:function(t){var i=e("#wpProQuiz_loadData"),a=e("#wpProQuiz_content");t?(i.hide(),a.show()):(a.hide(),i.show())},reset:function(a){var r=e("#userSelect").val();if(confirm(wpProQuizLocalize.reset_statistics_msg)){var s={quizId:i,userId:r,testId:n.testSelect.val(),type:a};t.toggleLoadBox(!1),o.ajaxPost("statisticReset",s,function(){t.loadUsersStatistic()})}},loadStatisticOverview:function(a){var r={quizId:i,pageLimit:e("#wpProQuiz_pageLimit").val(),onlyCompleted:Number(e("#wpProQuiz_onlyCompleted").is(":checked")),page:n.currentPage.val(),nav:Number(a)};t.toggleLoadBox(!1),o.ajaxPost("statisticLoadOverview",r,function(i){var a=e("#wpProQuiz_statistics_overview_data"),n=a.children(),o=n.first().clone();n.slice(1).remove(),e.each(i.items,function(){var i=o.clone();t.setStatisticData(i,this),i.find("a").text(this.userName).data("userId",this.userId).on("click",function(){return e("#userSelect").val(e(this).data("userId")),e("#wpProQuiz_typeUser").click(),!1}),i.show().appendTo(a)}),o.remove(),t.toggleLoadBox(!0),null!=i.page&&t.handleNav(i.page)})},handleNav:function(i){for(var a=e("#wpProQuiz_currentPage").empty(),n=1;n<=i;n++)e(document.createElement("option")).val(n).text(n).appendTo(a);t.checkNavBar()},checkNavBar:function(){var e=n.currentPage.val();1==e?n.pageLeft.hide():n.pageLeft.show(),e==n.currentPage.children().length?n.pageRight.hide():n.pageRight.show()},refresh:function(){"users"==a?t.loadUsersStatistic():"formOverview"==a?t.loadFormsOverview(!0):t.loadStatisticOverview(!0)},loadFormsOverview:function(a){var n={quizId:i,pageLimit:e("#wpProQuiz_fromPageLimit").val(),onlyUser:e("#wpProQuiz_formUser").val(),page:e("#wpProQuiz_formCurrentPage").val(),nav:Number(a)};t.toggleLoadBox(!1),o.ajaxPost("statisticLoadFormOverview",n,function(i){var a=e("#wpProQuiz_statistics_form_data"),n=a.children(),o=n.first().clone();n.slice(1).remove(),e.each(i.items,function(){var i=o.clone();t.setStatisticData(i,this),i.find("a").text(this.userName).data("userId",this.userId).data("testId",this.testId).on("click",function(){return t.switchTabOnLoad("users"),t.loadUsersStatistic_(e(this).data("userId"),e(this).data("testId")),!1}),i.show().appendTo(a)}),o.remove(),t.toggleLoadBox(!0),null!=i.page&&t.handleFormNav(i.page)})},handleFormNav:function(i){for(var a=e("#wpProQuiz_formCurrentPage").empty(),n=1;n<=i;n++)e(document.createElement("option")).val(n).text(n).appendTo(a);t.checkFormNavBar()},checkFormNavBar:function(){var t=e("#wpProQuiz_formCurrentPage").val();1==t?e("#wpProQuiz_formPageLeft").hide():e("#wpProQuiz_formPageLeft").show(),t==e("#wpProQuiz_formCurrentPage").children().length?e("#wpProQuiz_formPageRight").hide():e("#wpProQuiz_formPageRight").show()},switchTabOnLoad:function(t){e(".wpProQuiz_tab").removeClass("button-primary").addClass("button-secondary"),e(".wpProQuiz_tabContent").hide();var i=e("#wpProQuiz_typeOverview");"users"==t?(a="users",e("#wpProQuiz_tabUsers").show(),i=e("#wpProQuiz_typeUser")):"formOverview"==t?(a="formOverview",e("#wpProQuiz_tabFormOverview").show(),i=e("#wpProQuiz_typeForm")):(a="overview",e("#wpProQuiz_tabOverview").show()),i.removeClass("button-secondary").addClass("button-primary")}};var r=function(){e("#userSelect, #testSelect").on("change",function(){t.loadUsersStatistic()}),e(".wpProQuiz_update").on("click",function(){t.refresh()}),e("#wpProQuiz_reset").on("click",function(){t.reset(0)}),e("#wpProQuiz_resetUser").on("click",function(){t.reset(1)}),e(".wpProQuiz_resetComplete").on("click",function(){t.reset(2)}),e(".wpProQuiz_tab").on("click",function(){var i=e(this);return e(".wpProQuiz_tab").removeClass("button-primary").addClass("button-secondary"),i.removeClass("button-secondary").addClass("button-primary"),e(".wpProQuiz_tabContent").hide(),"wpProQuiz_typeUser"==i.attr("id")?(a="users",e("#wpProQuiz_tabUsers").show(),t.loadUsersStatistic()):"wpProQuiz_typeForm"==i.attr("id")?(a="formOverview",e("#wpProQuiz_tabFormOverview").show(),t.loadFormsOverview(!0)):(a="overview",e("#wpProQuiz_tabOverview").show(),t.loadStatisticOverview(!0)),!1}),e("#wpProQuiz_onlyCompleted").on("change",function(){n.currentPage.val(1),t.loadStatisticOverview(!0)}),e("#wpProQuiz_pageLimit").on("change",function(){n.currentPage.val(1),t.loadStatisticOverview(!0)}),n.pageLeft.on("click",function(){n.currentPage.val(Number(n.currentPage.val())-1),t.loadStatisticOverview(!1),t.checkNavBar()}),n.pageRight.on("click",function(){n.currentPage.val(Number(n.currentPage.val())+1),t.loadStatisticOverview(!1),t.checkNavBar()}),n.currentPage.on("change",function(){t.loadStatisticOverview(!1),t.checkNavBar()}),e("#wpProQuiz_formUser, #wpProQuiz_fromPageLimit").on("change",function(){e("#wpProQuiz_formCurrentPage").val(1),t.loadFormsOverview(!0)}),e("#wpProQuiz_formPageLeft").on("click",function(){e("#wpProQuiz_formCurrentPage").val(Number(n.currentPage.val())-1),t.loadFormsOverview(!1),t.checkFormNavBar()}),e("#wpProQuiz_formPageRight").on("click",function(){e("#wpProQuiz_formCurrentPage").val(Number(n.currentPage.val())+1),t.loadFormsOverview(!1),t.checkFormNavBar()}),e("#wpProQuiz_formCurrentPage").on("change",function(){t.loadFormsOverview(!1),t.checkFormNavBar()}),t.loadUsersStatistic()};r()},statisticNew:function(){var t=e("#quizId").val(),a=e("#quiz").val(),n=null,r=null,s={data:{quizId:t,quiz:a,users:-1,pageLimit:100,dateFrom:0,dateTo:0,generateNav:0},changeFilter:function(){var t=function(e){var t=e.datepicker("getDate");return null===t?0:t.getTime()/1e3},i=e("#wpProQuiz_historyUser").val();return void 0!==i&&""!==i&&null!==i||(i="-1"),e.extend(this.data,{users:i,pageLimit:e("#wpProQuiz_historyPageLimit").val(),dateFrom:t(e("#datepickerFrom")),dateTo:t(e("#datepickerTo")),generateNav:1}),this.data}},c={data:{pageLimit:100,onlyCompleted:0,generateNav:0,quizId:t,quiz:a},changeFilter:function(){e.extend(this.data,{pageLimit:e("#wpProQuiz_overviewPageLimit").val(),onlyCompleted:Number(e("#wpProQuiz_overviewOnlyCompleted").is(":checked")),generateNav:1})}},u={deleteUserStatistic:function(i,a){if(!confirm(wpProQuizLocalize.reset_statistics_msg))return!1;var n={refId:i,userId:a,quizId:t,type:0};o.ajaxPost("statisticResetNew",n,function(){e("#wpProQuiz_user_overlay").hide(),s.changeFilter(),l.loadHistoryAjax(),c.changeFilter(),l.loadOverviewAjax()})},deleteAll:function(){if(!confirm(wpProQuizLocalize.reset_statistics_msg))return!1;var e={quizId:t,type:1};o.ajaxPost("statisticResetNew",e,function(){s.changeFilter(),l.loadHistoryAjax(),c.changeFilter(),l.loadOverviewAjax()})}},l={loadHistoryAjax:function(){var t=e.extend({page:s.data.generateNav?1:n.getCurrentPage()},s.data);l.loadBox(!0);var i=e("#wpProQuiz_historyLoadContext").hide();o.ajaxPost("statisticLoadHistory",t,function(t){i.html(t.html).show(),t.navi&&n.setNumPage(t.navi),s.data.generateNav=0,i.find(".user_statistic").on("click",function(){return l.loadUserAjax(0,e(this).data("ref_id"),!1),!1}),i.find(".wpProQuiz_delete").on("click",function(){return u.deleteUserStatistic(e(this).parents("tr").find(".user_statistic").data("ref_id"),0),!1}),l.loadBox(!1)})},loadUserAjax:function(i,a,n){e("#wpProQuiz_user_overlay, #wpProQuiz_loadUserData").show();var r=e("#wpProQuiz_user_content").hide(),s={quizId:t,userId:i,refId:a,avg:Number(n)};o.ajaxPost("statisticLoadUser",s,function(t){r.html(t.html),r.find(".wpProQuiz_update").on("click",function(){return l.loadUserAjax(i,a,n),!1}),r.find("#wpProQuiz_resetUserStatistic").on("click",function(){u.deleteUserStatistic(a,i)}),r.find(".statistic_data").on("click",function(){return e(this).parents("tr").next().toggle("fast"),!1}),e("#wpProQuiz_loadUserData").hide(),jQuery("body").trigger("learndash-statistics-contentchanged"),r.show()})},loadBox:function(t,i){t?e("#wpProQuiz_loadDataHistory").show():e("#wpProQuiz_loadDataHistory").hide()},loadOverviewAjax:function(){var t=e.extend({page:c.data.generateNav?1:r.getCurrentPage()},c.data);e("#wpProQuiz_loadDataOverview").show();var i=e("#wpProQuiz_overviewLoadContext").hide();o.ajaxPost("statisticLoadOverviewNew",t,function(t){i.html(t.html).show(),t.navi&&r.setNumPage(t.navi),c.data.generateNav=0,i.find(".user_statistic").on("click",function(){return l.loadUserAjax(e(this).data("user_id"),0,!0),!1}),i.find(".wpProQuiz_delete").on("click",function(){return u.deleteUserStatistic(0,e(this).parents("tr").find(".user_statistic").data("user_id")),!1}),e("#wpProQuiz_loadDataOverview").hide()})},usersSelect2Ajax:function(t){var i=jQuery(t).data("nonce");return void 0===i||""===i?null:(jQuery(t).on("select2:unselect",function(e){jQuery(t).trigger("change")}),{url:learndash_admin_settings_data.ajaxurl,dataType:"json",method:"post",delay:1500,cache:!0,data:function(t){return{action:"learndash_quiz_statistics_users_select2",nonce:i||"",search:t.term||"",page:t.page||1,quiz_pro_id:e("input#quizId").val(),quiz_post_id:e("input#quiz").val()}},processResults:function(e,t){return t.page=t.page||1,{results:e.items,pagination:{more:t.page<e.total_pages}}}})}},d=function(){n=new i(e("#historyNavigation"),{onChange:function(){l.loadHistoryAjax()}}),r=new i(e("#overviewNavigation"),{onChange:function(){l.loadOverviewAjax()}}),wpProQuizLocalize.select2_enabled&&jQuery('#wpProQuiz_tabHistory select#wpProQuiz_historyUser[data-ld-select2="1"]').length&&jQuery('#wpProQuiz_tabHistory select#wpProQuiz_historyUser[data-ld-select2="1"]').each(function(e,t){var i=learndash_get_base_select2_args();i.width="auto";var a=jQuery(t).attr("placeholder");void 0!==a&&""!==a||(a=jQuery("option[value='']",t).text()),void 0!==a&&""!==a||(a="Select an option"),i.placeholder=a,wpProQuizLocalize.select2_fetch_enabled&&(i.ajax=l.usersSelect2Ajax(t)),jQuery(t).select2(i)}),(e("#datepickerFrom").length||e("#datepickerTo").length)&&(e(document).on("DOMNodeInserted",function(t){"ui-datepicker-div"==t.target.id&&e("#ui-datepicker-div").addClass("learndash-datepicker")}),e("#datepickerFrom").datepicker({closeText:wpProQuizLocalize.closeText,currentText:wpProQuizLocalize.currentText,monthNames:wpProQuizLocalize.monthNames,monthNamesShort:wpProQuizLocalize.monthNamesShort,dayNames:wpProQuizLocalize.dayNames,dayNamesShort:wpProQuizLocalize.dayNamesShort,dayNamesMin:wpProQuizLocalize.dayNamesMin,dateFormat:wpProQuizLocalize.dateFormat,firstDay:wpProQuizLocalize.firstDay,changeMonth:!0,onClose:function(t){e("#datepickerTo").datepicker("option","minDate",t)}}),e("#datepickerTo").datepicker({closeText:wpProQuizLocalize.closeText,currentText:wpProQuizLocalize.currentText,monthNames:wpProQuizLocalize.monthNames,monthNamesShort:wpProQuizLocalize.monthNamesShort,dayNames:wpProQuizLocalize.dayNames,dayNamesShort:wpProQuizLocalize.dayNamesShort,dayNamesMin:wpProQuizLocalize.dayNamesMin,dateFormat:wpProQuizLocalize.dateFormat,firstDay:wpProQuizLocalize.firstDay,changeMonth:!0,onClose:function(t){e("#datepickerFrom").datepicker("option","maxDate",t)}})),e("#filter").on("click",function(){s.changeFilter(),l.loadHistoryAjax()}),e("#wpProQuiz_overlay_close").on("click",function(){e("#wpProQuiz_user_overlay").hide()}),e("#wpProQuiz_tabHistory .wpProQuiz_update").on("click",function(){return s.changeFilter(),l.loadHistoryAjax(),!1}),e("#wpProQuiz_tabOverview .wpProQuiz_update").on("click",function(){return c.changeFilter(),l.loadOverviewAjax(),!1}),e(".wpProQuiz_resetComplete").on("click",function(){return u.deleteAll(),!1}),e("#overviewFilter").on("click",function(){c.changeFilter(),l.loadOverviewAjax()}),s.changeFilter(),l.loadHistoryAjax(),c.changeFilter(),l.loadOverviewAjax()};d()}},c=function(){r();var t=e.noop;e(".wpProQuiz_questionEdit").length||e("body.learndash-post-type.sfwd-question").length?t=s.questionEdit:e(".wpProQuiz_globalSettings").length?t=s.gobalSettings:e(".wpProQuiz_statistics").length?t=s.statistic:e(".wpProQuiz_statisticsNew").length&&(t=s.statisticNew),t(),e(".wpProQuiz_demoImgBox a").mouseover(function(t){var i=e(this),a=e(document).width(),n=i.siblings().outerWidth(!0);if(t.pageX+n>a){var o=a-(t.pageX+n+30);e(this).next().css("left",o+"px")}e(this).next().show()}).mouseout(function(){e(this).next().hide()}).on("click",function(){return!1})};c()}function i(t,i){var a={onChange:null},n={contain:null,pageLeft:null,pageRight:null,currentPage:null},o=function(){var e=n.currentPage.children().length,t=Number(n.currentPage.val());n.pageLeft.hide(),n.pageRight.hide(),t>1&&n.pageLeft.show(),t+1<=e&&n.pageRight.show()},r=function(){e.extend(n,{contain:t,pageLeft:t.find(".navigationLeft"),pageRight:t.find(".navigationRight"),currentPage:t.find(".navigationCurrentPage")}),e.extend(a,i),n.pageLeft.on("click",function(){n.currentPage.val(Number(n.currentPage.val())-1),o(),a.onChange&&a.onChange(n.currentPage.val())}),n.pageRight.on("click",function(){n.currentPage.val(Number(n.currentPage.val())+1),o(),a.onChange&&a.onChange(n.currentPage.val())}),n.currentPage.on("change",function(){o(),a.onChange&&a.onChange(n.currentPage.val())})};this.getCurrentPage=function(){return n.currentPage.val()},this.setNumPage=function(t){n.currentPage.empty();for(var i=1;i<=t;i++)e(document.createElement("option")).val(i).text(i).appendTo(n.currentPage);o()},r()}e.fn.wpProQuiz_preview=function(){var t={openPreview:function(t){window.open(e(t).attr("href"),"wpProQuizPreview","width=900,height=900")}},i=function(){e(".wpProQuiz_prview").on("click",function(e){t.openPreview(this),e.preventDefault()})};i()},
e.fn.wpProQuiz_quizOverall=function(){var t={changeExport:function(t){$input=e(t),$export=e(".wpProQuiz_exportList"),$ul=$export.find("ul").first(),$export.find("li").remove(),e('input[name="exportItems"]').each(function(){if($this=e(this),this.checked){var t=$this.parent().parent().find(".wpProQuiz_quizName a:eq(0)").text();e("<li>"+t+"</li>").appendTo($ul)}})},startExport:function(){return $ele=e('input[name="exportItems"]:checked'),$ele.length<1?(alert(wpProQuizLocalize.no_selected_quiz),!1):($hidden=e("#exportHidden"),$hidden.html(""),e('input[name="exportItems"]').each(function(){$this=e(this),this.checked&&e('<input type="hidden" value="'+this.value+'" name="exportIds[]">').appendTo($hidden)}),!0)}},i=function(){e(".wpProQuiz_delete").on("click",function(e){var t=confirm(wpProQuizLocalize.delete_msg);return!!t||(e.preventDefault(),!1)}),e(".wpProQuiz_import").on("click",function(t){t.preventDefault(),e(".wpProQuiz_importList").toggle("fast"),e(".wpProQuiz_exportList").hide(),e(".wpProQuiz_exportCheck").hide()}),e(".wpProQuiz_export").on("click",function(t){t.preventDefault(),e(".wpProQuiz_exportList").toggle("fast"),e(".wpProQuiz_exportCheck").toggle("fast"),e(".wpProQuiz_importList").hide()}),e('input[name="exportItems"]').on("change",function(){t.changeExport(this)}),e('input[name="exportItemsAll"]').on("change",function(){var t=e('input[name="exportItems"]');this.checked?t.attr("checked",!0):t.attr("checked",!1),t.change()}),e("#exportStart").on("click",function(e){t.startExport()||e.preventDefault()})};i()},e.fn.wpProQuiz_questionOverall=function(){var t={saveSort:function(){var i=jQuery("#wpProQuiz_nonce").data("nonce"),a={action:"wp_pro_quiz_update_sort",nonce:i,sort:t.parseSortArray()},n=window.location.pathname+window.location.search,o=n.replace("admin.php","admin-ajax.php")+"&action=save_sort";e.post(o,a,function(t){e("#sortMsg").show(400).delay(1e3).hide(400)})},parseSortArray:function(){var t=new Array;return e("tbody tr").each(function(){t.push(this.id.replace("wpProQuiz_questionId_",""))}),t},sortUpdate:function(t,i){e(".wpProQuiz_questionOverall tbody").children().each(function(){$t=e(this).children().first().text(e(this).index()+1)})},loadQuestionCopy:function(){var t=e("#questionCopySelect"),i=window.location.pathname+window.location.search,a=i.replace("admin.php","admin-ajax.php")+"&action=load_question",n=jQuery("#wpProQuiz_nonce").data("nonce"),o={action:"wp_pro_quiz_load_question",nonce:n,excludeId:1};t.hide(),t.empty(),e("#loadDataImg").show(),e.post(a,o,function(i){e.each(i,function(i,a){var n=e(document.createElement("optgroup"));n.attr("label",a.name),e.each(a.question,function(t,i){e(document.createElement("option")).val(i.id).text(i.name).appendTo(n)}),t.append(n)}),e("#loadDataImg").hide(),t.show()},"json")}},i=function(){e(".wp-list-table tbody").sortable({handle:".wpProQuiz_move",update:t.sortUpdate}),e(".wpProQuiz_delete").on("click",function(e){var t=confirm(wpProQuizLocalize.delete_msg);return!!t||(e.preventDefault(),!1)}),e("#wpProQuiz_saveSort").on("click",function(e){e.preventDefault(),t.saveSort()}),e("#wpProQuiz_questionCopy").on("click",function(i){var a=e(".wpProQuiz_questionCopy");a.is(":visible")?a.hide():(a.show(),t.loadQuestionCopy()),i.preventDefault()})};i()},e.fn.wpProQuiz_quizEdit=function(){var t={addResult:function(){e("#resultList").children().each(function(){if("none"==e(this).css("display")){var t=e(this),i=t.find('textarea[name="resultTextGrade[text][]"]'),a=i.attr("id"),n=!0;return t.find('input[name="resultTextGrade[prozent][]"]').val("1"),t.find('input[name="resultTextGrade[activ][]"]').val("1").keyup(),"undefined"==typeof tinymce||null==tinymce.editors[a]||tinymce.editors[a].isHidden()||(n=!1),null==switchEditors||n||(switchEditors.go(a,"toggle"),switchEditors.go(a,"toggle")),"undefined"!=typeof tinymce&&null!=tinymce.editors[a]?tinymce.editors[a].setContent(""):i.val(""),"undefined"==typeof tinymce||null==tinymce.editors[a]||n||tinyMCE.execCommand("mceRemoveControl",!1,a),t.parent().children(":visible").last().after(t),"undefined"==typeof tinymce||null==tinymce.editors[a]||n||tinyMCE.execCommand("mceAddControl",!1,a),e(this).show(),null==switchEditors||n||switchEditors.go(a,"toggle"),!1}})},deleteResult:function(t){e(t).parent().parent().hide(),e(t).siblings('input[name="resultTextGrade[activ][]"]').val("0")},changeResult:function(i){var a=e(i);return t.validResultInput(a.val())?(a.siblings(".resultProzent").text(a.val()),a.removeAttr("style"),!0):(a.css("background-color","#FF9696"),!1)},validResultInput:function(e){return!i(e)&&(e=e.replace(/\,/,"."),!isNaN(e)&&Number(e)<=100&&Number(e)>=0&&(null==e.match(/\./)||e.split(".")[1].length<3))},validInput:function(){if(i(e("#wpProQuiz_title").val()))return alert(wpProQuizLocalize.no_title_msg),!1;var a="";if(a="undefined"==typeof tinymce||null==tinymce.editors.text||tinymce.editors.text.isHidden()?e('textarea[name="text"]').val():tinymce.editors.text.getContent(),i(a))return alert(wpProQuizLocalize.no_quiz_start_msg),!1;if(e("#wpProQuiz_resultGradeEnabled:checked").length){var n=!0;if(e("#resultList").children().each(function(){if(e(this).is(":visible")&&!t.validResultInput(e(this).find('input[name="resultTextGrade[prozent][]"]').val()))return n=!1,!1}),!n)return alert(wpProQuizLocalize.fail_grade_result),!1}return!0},resetLock:function(){var t=window.location.pathname+window.location.search,i=t.replace("post.php","admin-ajax.php");i=i.replace("action=edit","action=reset_lock");var a=e('input[name="resetQuizLock"]').data("nonce");e.post(i,{action:"wp_pro_quiz_reset_lock",nonce:a},function(t){e("#resetLockMsg").show("fast").delay(2e3).hide("fast")})},generateFormIds:function(){var t=0;e("#form_table tbody > tr").each(function(){e(this).find('[name^="form[]"]').each(function(){var i=e(this).attr("name").substr(6);e(this).attr("name","form["+t+"]"+i)}),++t})}},i=function(t){return t=e.trim(t),!t||0===t.length},a=function(){e("#statistics_on").on("change",function(){this.checked?(e("#statistics_ip_lock_tr").show(),e("#statistics_show_profile_tr").show()):(e("#statistics_ip_lock_tr").hide(),e("#statistics_show_profile_tr").hide())}),e(".addResult").on("click",function(){t.addResult()}),e(".deleteResult").on("click",function(e){t.deleteResult(this)}),e('input[name="resultTextGrade[prozent][]"]').keyup(function(e){t.changeResult(this)}).keydown(function(e){13==e.which&&e.preventDefault()}),e("#wpProQuiz_resultGradeEnabled").on("change",function(){this.checked?(e("#resultGrade").show(),e("#resultNormal").hide()):(e("#resultGrade").hide(),e("#resultNormal").show())}),window.postL10n?(e("#wpProQuiz_save,input[name=save]").on("click",function(i){t.generateFormIds(),e('select[name="prerequisiteList[]"] option').attr("selected","selected")}),e("#publish").on("click",function(){t.generateFormIds(),e('select[name="prerequisiteList[]"] option').attr("selected","selected")}),e("#save-post").on("click",function(){t.generateFormIds(),e('select[name="prerequisiteList[]"] option').attr("selected","selected")})):window.wp.data.subscribe(()=>{!0===window.wp.data.select("core/editor").isSavingPost()&&(t.generateFormIds(),e('select[name="prerequisiteList[]"] option').attr("selected","selected"))}),e('input[name="template"]').on("click",function(a){if("0"==e('select[name="templateSaveList"]').val()&&i(e('input[name="templateName"]').val()))return alert(wpProQuizLocalize.temploate_no_name),a.preventDefault(),!1;t.generateFormIds(),e('select[name="prerequisiteList[]"] option').attr("selected","selected")}),e('select[name="templateSaveList"]').on("change",function(){var t=e('input[name="templateName"]');"0"==e(this).val()?t.show():t.hide()}).change(),e('input[name="quizRunOnce"]').on("change",function(t){this.checked?(e("#wpProQuiz_quiz_run_once_type").show(),e('input[name="quizRunOnceType"]:checked').change()):e("#wpProQuiz_quiz_run_once_type").hide()}),e('input[name="quizRunOnceType"]').on("change",function(t){!this.checked||"1"!=this.value&&"3"!=this.value?e("#wpProQuiz_quiz_run_once_cookie").hide():e("#wpProQuiz_quiz_run_once_cookie").show()}),e('input[name="resetQuizLock"]').on("click",function(e){return t.resetLock(),!1}),e(".wpProQuiz_demoBox a").mouseover(function(t){var i=e(this),a=e(document).width(),n=i.siblings().outerWidth(!0);if(t.pageX+n>a){var o=a-(t.pageX+n+30);e(this).next().css("left",o+"px")}e(this).next().show()}).mouseout(function(){e(this).next().hide()}).on("click",function(){return!1}),e('input[name="showMaxQuestion"]').on("change",function(){this.checked?e("#wpProQuiz_showMaxBox").show():e("#wpProQuiz_showMaxBox").hide()}),e("#btnPrerequisiteAdd").on("click",function(){e('select[name="quizList"] option:selected').removeAttr("selected").appendTo('select[name="prerequisiteList[]"]')}),e("#btnPrerequisiteDelete").on("click",function(){e('select[name="prerequisiteList[]"] option:selected').removeAttr("selected").appendTo('select[name="quizList"]')}),e('input[name="prerequisite"]').on("change",function(){this.checked?e("#prerequisiteBox").show():e("#prerequisiteBox").hide()}).change(),e('input[name="toplistDataAddMultiple"]').on("change",function(){this.checked?e("#toplistDataAddBlockBox").show():e("#toplistDataAddBlockBox").hide()}).change(),e('input[name="toplistActivated"]').on("change",function(){this.checked?e("#toplistBox > tr:gt(0)").show():e("#toplistBox > tr:gt(0)").hide()}).change(),e('input[name="showReviewQuestion"]').on("change",function(){this.checked?e(".wpProQuiz_reviewQuestionOptions").show():e(".wpProQuiz_reviewQuestionOptions").hide()}).change(),e("#statistics_on").change(),e("#wpProQuiz_resultGradeEnabled").change(),e('input[name="quizRunOnce"]').change(),e('input[name="quizRunOnceType"]:checked').change(),e('input[name="showMaxQuestion"]').change(),e("#form_add").on("click",function(){e("#form_table tbody > tr:eq(0)").clone(!0).appendTo("#form_table tbody").show(),e('#form_table tbody tr:last input[type="text"]').focus()}),e('input[name="form_delete"]').on("click",function(){var t=e(this).parents("tr");"0"!=t.find('input[name="form[][form_id]"]').val()?(t.find('input[name="form[][form_delete]"]').val(1),t.hide()):t.remove()}),e("#form_table tbody").sortable({handle:".form_move",update:t.sortUpdate}),e(".form_move").on("click",function(){return!1}),e('select[name="form[][type]"]').on("change",function(){switch(Number(e(this).val())){case 7:case 8:e(this).siblings(".editDropDown").show();break;default:e(this).siblings(".editDropDown, .dropDownEditBox").hide()}}).change(),e(".editDropDown").on("click",function(){return e(".dropDownEditBox").not(e(this).siblings(".dropDownEditBox").toggle()).hide(),!1}),e(".dropDownEditBox input").on("click",function(){e(this).parent().hide()})};a()},e.fn.wpProQuiz_statistics=function(){var t="wpProQuiz_typeAnonymeUser",i=!0,a={loadStatistics:function(t){var i=window.location.pathname+window.location.search,n=i.replace("admin.php","admin-ajax.php")+"&action=load_statistics",o={action:"wp_pro_quiz_load_statistics",userId:t};e("#wpProQuiz_loadData").show(),e("#wpProQuiz_statistics_content, #wpProQuiz_statistics_overview").hide(),e.post(n,o,a.setStatistics,"json")},setStatistics:function(i){var a=e(".wpProQuiz_statistics_table"),n=a.find("tbody");if("wpProQuiz_typeOverview"!=t){var o=function(e,t,i){e.find(".wpProQuiz_cCorrect").text(t.cCorrect+" ("+t.pCorrect+"%)"),e.find(".wpProQuiz_cIncorrect").text(t.cIncorrect+" ("+t.pIncorrect+"%)"),e.find(".wpProQuiz_cTip").text(t.cTip),e.find(".wpProQuiz_cPoints").text(t.cPoints),1==i&&a.find(".wpProQuiz_cResult").text(t.result+"%")};o(a,i.clear,!1),e.each(i.items,function(e,t){o(n.find("#wpProQuiz_tr_"+t.id),t,!1)}),o(a.find("tfoot"),i.global,!0),e("#wpProQuiz_loadData").hide(),e("#wpProQuiz_statistics_content, .wpProQuiz_statistics_table").show()}},loadOverview:function(){e(".wpProQuiz_statistics_table, #wpProQuiz_statistics_content, #wpProQuiz_statistics_overview").hide(),e("#wpProQuiz_loadData").show();var n=window.location.pathname+window.location.search,o=n.replace("admin.php","admin-ajax.php")+"&action=load_statistics",r={action:"wp_pro_quiz_load_statistics",overview:!0,pageLimit:e("#wpProQuiz_pageLimit").val(),onlyCompleted:Number(e("#wpProQuiz_onlyCompleted").is(":checked")),page:e("#wpProQuiz_currentPage").val(),generatePageNav:Number(i)};e.post(o,r,function(n){if(e("#wpProQuiz_statistics_overview_data").empty(),"wpProQuiz_typeOverview"==t){var o=e('<tr><th><a href="#">---</a></th><th class="wpProQuiz_points">---</th><th class="wpProQuiz_cCorrect" style="color: green;">---</th><th class="wpProQuiz_cIncorrect" style="color: red;">---</th><th class="wpProQuiz_cTip">---</th><th class="wpProQuiz_cResult" style="font-weight: bold;">---</th></tr>');e.each(n.items,function(t,i){var a=o.clone();a.find("a").text(i.userName).data("userId",i.userId).on("click",function(){return e("#userSelect").val(e(this).data("userId")),e("#wpProQuiz_typeRegisteredUser").click(),!1}),i.completed?(a.find(".wpProQuiz_points").text(i.cPoints),a.find(".wpProQuiz_cCorrect").text(i.cCorrect+" ("+i.pCorrect+"%)"),a.find(".wpProQuiz_cIncorrect").text(i.cIncorrect+" ("+i.pIncorrect+"%)"),a.find(".wpProQuiz_cTip").text(i.cTip),a.find(".wpProQuiz_cResult").text(i.result+"%")):a.find("th").removeAttr("style"),e("#wpProQuiz_statistics_overview_data").append(a)}),null!=n.page&&(a.setPageNav(n.page),i=!1),e("#wpProQuiz_loadData").hide(),e("#wpProQuiz_statistics_overview").show()}},"json")},loadFormOverview:function(){e("#wpProQuiz_tabFormOverview").show()},changeTab:function(i){t=i,"wpProQuiz_typeRegisteredUser"==i?a.loadStatistics(e("#userSelect").val()):"wpProQuiz_typeAnonymeUser"==i?a.loadStatistics(0):"wpProQuiz_typeForm"==i?a.loadFormOverview():a.loadOverview()},resetStatistic:function(i){var n="wpProQuiz_typeRegisteredUser"==t?e("#userSelect").val():0,o=window.location.pathname+window.location.search,r=o.replace("admin.php","admin-ajax.php")+"&action=reset",s={action:"wp_pro_quiz_statistics",userId:n,complete:i};e.post(r,s,function(e){a.changeTab(t)})},setPageNav:function(t){t=Math.ceil(t/e("#wpProQuiz_pageLimit").val()),e("#wpProQuiz_currentPage").empty();for(var i=1;i<=t;i++)e(document.createElement("option")).val(i).text(i).appendTo(e("#wpProQuiz_currentPage"));e("#wpProQuiz_pageLeft, #wpProQuiz_pageRight").hide(),e("#wpProQuiz_currentPage option").length>1&&e("#wpProQuiz_pageRight").show()}},n=function(){e(".wpProQuiz_tab").on("click",function(t){var i=e(this);return!i.hasClass("button-primary")&&("wpProQuiz_typeRegisteredUser"==i.attr("id")?e("#wpProQuiz_userBox").show():e("#wpProQuiz_userBox").hide(),e(".wpProQuiz_tab").removeClass("button-primary").addClass("button-secondary"),i.removeClass("button-secondary").addClass("button-primary"),a.changeTab(i.attr("id")),!1)}),e("#userSelect").on("change",function(){a.changeTab("wpProQuiz_typeRegisteredUser")}),e(".wpProQuiz_update").on("click",function(){return a.changeTab(t),!1}),e("#wpProQuiz_reset").on("click",function(){var e=confirm(wpProQuizLocalize.reset_statistics_msg);return e&&a.resetStatistic(!1),!1}),e(".wpProQuiz_resetComplete").on("click",function(){var e=confirm(wpProQuizLocalize.reset_statistics_msg);return e&&a.resetStatistic(!0),!1}),e("#wpProQuiz_pageLimit, #wpProQuiz_onlyCompleted").on("change",function(){return e("#wpProQuiz_currentPage").val(0),i=!0,a.changeTab(t),!1}),e("#wpProQuiz_currentPage").on("change",function(){e("#wpProQuiz_pageLeft, #wpProQuiz_pageRight").hide(),1==e("#wpProQuiz_currentPage option").length||(e("#wpProQuiz_currentPage option:first-child:selected").length?e("#wpProQuiz_pageRight").show():e("#wpProQuiz_currentPage option:last-child:selected").length?e("#wpProQuiz_pageLeft").show():e("#wpProQuiz_pageLeft, #wpProQuiz_pageRight").show()),a.changeTab(t)}),e("#wpProQuiz_pageRight").on("click",function(){return e("#wpProQuiz_currentPage option:selected").next().attr("selected","selected"),e("#wpProQuiz_currentPage").change(),!1}),e("#wpProQuiz_pageLeft").on("click",function(){return e("#wpProQuiz_currentPage option:selected").prev().attr("selected","selected"),e("#wpProQuiz_currentPage").change(),!1}),a.changeTab("wpProQuiz_typeAnonymeUser")};n()},e.fn.wpProQuiz_toplist=function(){var t={sort:e("#wpProQuiz_sorting"),pageLimit:e("#wpProQuiz_pageLimit"),currentPage:e("#wpProQuiz_currentPage"),loadDataBox:e("#wpProQuiz_loadData"),pageLeft:e("#wpProQuiz_pageLeft"),pageRight:e("#wpProQuiz_pageRight"),dataBody:e("#wpProQuiz_toplistTable tbody"),rowClone:e("#wpProQuiz_toplistTable tbody tr:eq(0)").clone(),content:e("#wpProQuiz_content")},i={loadData:function(i){var a=window.location.pathname+window.location.search,n=a.replace("admin.php","admin-ajax.php")+"&action=load_toplist",o=e("#wpProQuiz_loadData").data("nonce"),r=this,s={action:"wp_pro_quiz_load_toplist",nonce:o,sort:t.sort.val(),limit:t.pageLimit.val(),page:t.currentPage.val()};null!=i&&e.extend(s,i),t.loadDataBox.show(),t.content.hide(),e.post(n,s,function(e){r.handleDataRequest(e.data),null!=e.nav&&r.handleNav(e.nav),t.loadDataBox.hide(),t.content.show()},"json")},handleNav:function(i){t.currentPage.empty();for(var a=1;a<=i.pages;a++)e(document.createElement("option")).val(a).text(a).appendTo(t.currentPage);this.checkNav()},handleDataRequest:function(i){var a=this;t.dataBody.empty(),e.each(i,function(e,i){var a=t.rowClone.clone().children();a.eq(0).children().val(i.id),a.eq(1).find("strong").text(i.name),a.eq(1).find(".inline_editUsername").val(i.name),a.eq(2).find(".wpProQuiz_email").text(i.email),a.eq(2).find("input").val(i.email),a.eq(3).text(i.type),a.eq(4).text(i.date),a.eq(5).text(i.points),a.eq(6).text(i.result),a.parent().show().appendTo(t.dataBody)}),i.length||e(document.createElement("td")).attr("colspan","7").text(wpProQuizLocalize.no_data_available).css({"font-weight":"bold","text-align":"center",padding:"5px"}).appendTo(document.createElement("tr")).appendTo(t.dataBody),e(".wpProQuiz_delete").on("click",function(){if(confirm(wpProQuizLocalize.confirm_delete_entry)){var t=new Array(e(this).closest("tr").find('input[name="checkedData[]"]').val());a.loadData({a:"delete",toplistIds:t})}return!1}),e(".wpProQuiz_edit").on("click",function(){var t=e(this).closest("tr");return t.find(".row-actions").hide(),t.find(".inline-edit").show(),t.find(".wpProQuiz_username, .wpProQuiz_email").hide(),t.find(".inline_editUsername, .inline_editEmail").show(),!1}),e(".inline_editSave").on("click",function(){var t=e(this).closest("tr"),i=t.find(".inline_editUsername").val(),n=t.find(".inline_editEmail").val();return a.isEmpty(i)||a.isEmpty(n)?(alert(wpProQuizLocalize.not_all_fields_completed),!1):(a.loadData({a:"edit",toplistId:t.find('input[name="checkedData[]"]').val(),name:i,email:n}),!1)}),e(".inline_editCancel").on("click",function(){var t=e(this).closest("tr");return t.find(".row-actions").show(),t.find(".inline-edit").hide(),t.find(".wpProQuiz_username, .wpProQuiz_email").show(),t.find(".inline_editUsername, .inline_editEmail").hide(),t.find(".inline_editUsername").val(t.find(".wpProQuiz_username").text()),t.find(".inline_editEmail").val(t.find(".wpProQuiz_email").text()),!1})},checkNav:function(){var e=t.currentPage.val();1==e?t.pageLeft.hide():t.pageLeft.show(),e==t.currentPage.children().length?t.pageRight.hide():t.pageRight.show()},isEmpty:function(t){return t=e.trim(t),!t||0===t.length}},a=function(){t.sort.on("change",function(){i.loadData()}),t.pageLimit.on("change",function(){i.loadData({nav:1})}),t.currentPage.on("change",function(){i.checkNav(),i.loadData()}),t.pageLeft.on("click",function(){t.currentPage.val(Number(t.currentPage.val())-1),i.checkNav(),i.loadData()}),t.pageRight.on("click",function(){t.currentPage.val(Number(t.currentPage.val())+1),i.checkNav(),i.loadData()}),e("#wpProQuiz_deleteAll").on("click",function(){i.loadData({a:"deleteAll"})}),e("#wpProQuiz_action").on("click",function(){var t=e("#wpProQuiz_actionName").val();if("0"!=t){var a=e('input[name="checkedData[]"]:checked').map(function(){return e(this).val()}).get();i.loadData({a:t,toplistIds:a})}}),e("#wpProQuiz_checkedAll").on("change",function(){this.checked?e('input[name="checkedData[]"]').attr("checked","checked"):e('input[name="checkedData[]"]').removeAttr("checked","checked")}),i.loadData({nav:1})};a()},e(".wpProQuiz_quizOverall").length&&e(".wpProQuiz_quizOverall").wpProQuiz_preview(),e(".wpProQuiz_quizOverall").length&&e(".wpProQuiz_quizOverall").wpProQuiz_quizOverall(),e(".wpProQuiz_quizEdit").length&&e(".wpProQuiz_quizEdit").wpProQuiz_quizEdit(),e(".wpProQuiz_questionOverall").length&&e(".wpProQuiz_questionOverall").wpProQuiz_questionOverall(),e(".wpProQuiz_toplist").length&&e(".wpProQuiz_toplist").wpProQuiz_toplist(),t()});